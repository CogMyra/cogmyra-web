<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CogMyra Beta — Guide</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>CogMyra Beta — Guide</h1>
  <p>Quick smoke test for the hosted API.</p>
  
  <div>
    <strong>API Base:</strong>
    <span id="apiBase">https://cogmyra-api.onrender.com</span>
    <span id="statusDot" style="color:red;">● Offline</span>
  </div>

  <div>
    <h3>Chat</h3>
    <input id="userInput" placeholder="Ask something short..." />
    <button onclick="sendMessage()">Send</button>
    <p><strong>Assistant reply:</strong> <span id="reply">–</span></p>
  </div>

  <div>
    <h3>Logs</h3>
    <pre id="logs">{}</pre>
  </div>

  <script>
    const API_BASE = "https://cogmyra-api.onrender.com";

    async function checkHealth() {
      try {
        const res = await fetch(`${API_BASE}/api/health`, { mode: "cors" });
        if (res.ok) {
          document.getElementById("statusDot").textContent = "● Online";
          document.getElementById("statusDot").style.color = "green";
        } else {
          document.getElementById("statusDot").textContent = "● Offline";
          document.getElementById("statusDot").style.color = "red";
        }
      } catch (err) {
        document.getElementById("statusDot").textContent = "● Offline";
        document.getElementById("statusDot").style.color = "red";
      }
    }

    async function sendMessage() {
      const input = document.getElementById("userInput").value;
      const replyBox = document.getElementById("reply");
      const logs = document.getElementById("logs");

      try {
        const res = await fetch(`${API_BASE}/api/chat`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ model: "gpt-4.1", messages: [{ role: "user", content: input }] }),
        });

        const data = await res.json();
        replyBox.textContent = data.reply || JSON.stringify(data);
        logs.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        replyBox.textContent = "Error: " + err.message;
      }
    }

    checkHealth();
  </script>
</body>
</html>
